<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>blockly test</title>
  </head>
  <body>
    <xml id="toolbox" style="display: true">
      <!-- 必要なブロックを並べる -->
      <category name="じょうけん" colour="#55aa55">
        <block type="controls_if"></block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
      </category>
      <category name="ぶき" colour="#aa5555">
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_boolean"></block>
      </category>
      <category name="いどう／とくぎ" colour="#5555aa">
        <block type="text"></block>
        <block type="text_print"></block>
      </category>
    </xml>

    <div id="main_console" style="width: 100%; height: 500px;">
      <div id="blocklyDiv" style="width: 70%; height: 500px; display: inline-block;"></div>
      <div style="width: 29%; height: 500px; display: inline-block;">
        <canvas id='world' style="width: 100%; height: 500px; display: inline-block;"></canvas>
      </div>
      <textarea id="outputArea"style="width: 98%; height: 300px;"></textarea>
    </div>

    <script src="blockly/blockly_compressed.js"></script>
    <script src="blockly/blocks_compressed.js"></script>
    <script src="blockly/javascript_compressed.js"></script>
    <script src="blockly/msg/js/ja.js"></script>

    <script src="libs/phina.js"></script>

    <script>
      var workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox'),
        horizontalLayout: true,
        allowUndoRedo: true,
      });
      Blockly.mainWorkspace.undo(true);


      function ShowCode(e) {
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        document.getElementById("outputArea").value = code;
        console.log(e);
        const a = document.getElementById(":3.label");
        a.innnerHtml = "<img src='tomapiko.png'>"
      }
      //workspaceのリスナーへ登録
      workspace.addChangeListener(ShowCode);
    </script>

  </body>
</html>
